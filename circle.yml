machine:
  timezone:
    America/Chicago
    
  node:
    version: 6.1.0

  php:
    version: 7.1.3

  # This will be added to the `/etc/hosts` file
  hosts:
    wordpress-circleci.dev: 127.0.0.1

dependencies:
  pre:
    # No password is required for the MySQL user `ubuntu`
    - mysql -u wordpress -e "create database wordpress"
    
    # Use cURL to fetch WP-CLI
    - curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar
    
    # Make sure WP-CLI is executable
    - chmod +x wp-cli.phar
    
    # Download WordPress into `web` directory
    - ./wp-cli.phar core download --allow-root --path=web
    
    # Generate `wp-config.php` file
    - ./wp-cli.phar core config --allow-root --dbname=wordpress --dbuser=wordpress --dbhost=localhost --path=wordpress
    
    # Install WordPress
    - ./wp-cli.phar core install --allow-root --admin_name=admin --admin_password=admin --admin_email=admin@example.com --url=http://wordpress-circle.dev:8080 --title=WordPress --path=web
    
    # And use WP-CLI to install wp-cfm
    - ./wp-cli.phar plugin install wp-cfm
    
	 # Install gulp
	 - npm install gulp-cli

test:
  override:
    # This is just for us to see that the wp-cfm plugin was installed
    - ./wp-cli.phar plugin list --path=web
    
    # Finally, run our Behat features
    - vendor/bin/behat